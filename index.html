<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login ‚Äî Pixel Art</title>
  <link rel="icon" href="foto/foto.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --bg: #0b1220;
      --panel: #0f1724;
      --accent: #3ce0c3;
      --accent-2: #7c5cff;
      --muted: #b6c0d6;
      --box: #121826;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }

    body {
      font-family: "Press Start 2P", monospace;
      background: url('https://i.imgur.com/nvdnNzi.jpeg') center/cover no-repeat fixed;
      color: var(--muted);
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 1100px;
      background: rgba(11, 18, 32, 0.65);
      border: 4px solid #071022;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
    }

    header h1 {
      margin: 0 0 8px;
      font-size: clamp(14px, 4vw, 18px);
      color: var(--accent);
      text-align: center;
      position: relative;
    }

    header h1::before,
    header h1::after {
      content: attr(data-text);
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    header h1::before {
      color: #ff00c8;
      clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
      animation: glitch-1 3s infinite;
      opacity: 0.6;
    }

    header h1::after {
      color: #00ffe5;
      clip-path: polygon(0 55%, 100% 55%, 100% 100%, 0 100%);
      animation: glitch-2 3.2s infinite;
      opacity: 0.6;
    }

    @keyframes glitch-1 {
      0%, 95%, 100% { transform: translateX(0); }
      96% { transform: translateX(-2px); }
      98% { transform: translateX(2px); }
    }

    @keyframes glitch-2 {
      0%, 95%, 100% { transform: translateX(0); }
      96% { transform: translateX(2px); }
      98% { transform: translateX(-2px); }
    }

    header p {
      text-align: center;
      font-size: clamp(7px, 2.4vw, 9px);
      color: #93a0c0;
      margin-bottom: 16px;
    }

    /* ACCOUNT MODAL */
    .account-modal {
      background: #0f1625;
      border: 1px solid var(--accent);
      border-radius: 4px;
      padding: 8px;
      width: 120px;
      margin: 8px auto;
      text-align: center;
      font-size: 8px;
      display: none;
    }

    .account-modal #userUid {
      font-family: monospace;
      color: white;
      font-size: 10px;
      letter-spacing: 1px;
      margin: 4px 0;
    }

    .account-modal button {
      width: 100%;
      background: #ff5555;
      color: white;
      border: none;
      padding: 2px 4px;
      border-radius: 2px;
      font-family: "Press Start 2P", monospace;
      font-size: 7px;
      cursor: pointer;
      margin-top: 4px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 14px;
    }

    .box {
      background: #0f1625;
      border: 3px solid #071022;
      border-radius: 6px;
      padding: 14px;
      height: 140px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 4px 6px rgba(0,0,0,0.4);
    }

    .box:hover {
      transform: translateY(-4px);
      border-color: var(--accent-2);
      box-shadow: 0 6px 12px rgba(124, 92, 255, 0.3);
    }

    .box:hover .icon {
      animation: glitch-icon 0.6s;
    }

    @keyframes glitch-icon {
      0%, 100% { filter: hue-rotate(0deg); }
      20% { filter: hue-rotate(10deg); }
      40% { filter: hue-rotate(-10deg); }
      60% { filter: hue-rotate(5deg); }
    }

    .icon {
      font-size: 28px;
      margin-bottom: 8px;
      color: var(--accent-2);
    }

    .title {
      font-size: clamp(8px, 2.6vw, 10px);
      text-align: center;
      color: var(--muted);
    }

    .subtitle {
      font-size: clamp(7px, 2.2vw, 8px);
      color: #9fb1d6;
      margin-top: 4px;
    }

    footer {
      margin-top: 16px;
      text-align: center;
      font-size: clamp(7px, 2vw, 8px);
      color: #8ea0c6;
    }

    @media (max-width: 360px) {
      .box { height: 120px; padding: 10px; }
      .icon { font-size: 24px; }
      .account-modal { width: 100px; }
    }

    /* Popup */
    #warningPopup1 {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    #warningPopup1 .popup-box1 {
      background: #0f1625;
      color: white;
      padding: 18px;
      border: 2px solid var(--accent-2);
      border-radius: 8px;
      max-width: 280px;
      width: 90%;
      text-align: center;
      font-family: "Press Start 2P", monospace;
      font-size: 10px;
    }
    #warningPopup1 button {
      background: var(--accent-2);
      border: none;
      padding: 5px 10px;
      color: white;
      border-radius: 4px;
      font-family: "Press Start 2P", monospace;
      font-size: 9px;
      margin-top: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="container" id="mainContainer" role="main">
    <!-- Akan diisi dinamis -->
  </div>

  <!-- Popup Peringatan -->
  <div id="warningPopup1">
    <div class="popup-box1">
      <h2>‚ö†Ô∏è Peringatan!</h2>
      <p id="warningMessage1"></p>
      <button onclick="closeWarning1()">OK</button>
    </div>
  </div>

  <script>
    // === FIREBASE CONFIG ===
    const firebaseConfig = {
      apiKey: "AIzaSyC5HS7vsJVs9dtarPkzhQmiqNaeCKkJw_A",
      authDomain: "noxius-panel.firebaseapp.com",
      projectId: "noxius-panel",
      storageBucket: "noxius-panel.firebasestorage.app",
      messagingSenderId: "873696240519",
      appId: "1:873696240519:web:401f9efb0d71b32363a922",
      measurementId: "G-YNC6NQT179"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const mainContainer = document.getElementById('mainContainer');

    window.closeWarning1 = () => {
      document.getElementById("warningPopup1").style.display = "none";
    };

    // === GENERATE 8-DIGIT UID ===
    function generate8DigitUid() {
      return Math.floor(10000000 + Math.random() * 90000000).toString();
    }

    // === RENDER LOGIN ===
    function renderLogin() {
      mainContainer.innerHTML = `
        <header>
          <h1 data-text="LOGIN ‚Äî PIXEL PANEL">LOGIN ‚Äî PIXEL PANEL</h1>
          <p>Masukkan email dan password untuk melanjutkan.</p>
        </header>
        <div style="max-width: 320px; margin: 20px auto; padding: 16px;">
          <input type="email" id="email" placeholder="Email" style="width:100%; padding:8px; margin:6px 0; border-radius:4px; border:1px solid #3ce0c3; background:#0f1625; color:white; font-family:'Press Start 2P', monospace; font-size:10px;">
          <input type="password" id="password" placeholder="Password" style="width:100%; padding:8px; margin:6px 0; border-radius:4px; border:1px solid #3ce0c3; background:#0f1625; color:white; font-family:'Press Start 2P', monospace; font-size:10px;">
          <button id="loginBtn" style="width:100%; padding:8px; margin-top:10px; background:#7c5cff; color:white; border:none; border-radius:4px; font-family:'Press Start 2P', monospace; font-size:10px; cursor:pointer;">
            LOGIN
          </button>
          <button id="signupBtn" style="width:100%; padding:6px; margin-top:6px; background:transparent; color:#7c5cff; border:1px solid #7c5cff; border-radius:4px; font-family:'Press Start 2P', monospace; font-size:9px; cursor:pointer;">
            ‚ûï Buat Akun Baru
          </button>
          <button id="resetBtn" style="width:100%; padding:6px; margin-top:6px; background:transparent; color:#3ce0c3; border:1px solid #3ce0c3; border-radius:4px; font-family:'Press Start 2P', monospace; font-size:9px; cursor:pointer;">
            üîë Lupa Password?
          </button>
          <p id="loginError" style="color:#ff5555; margin-top:10px; font-size:9px; text-align:center;"></p>
        </div>
        <footer>
          2025 Pixel Art Project<br>KentangDev.
        </footer>
      `;

      document.getElementById('loginBtn').addEventListener('click', handleLogin);
      document.getElementById('signupBtn').addEventListener('click', renderSignup);
      document.getElementById('resetBtn').addEventListener('click', handleResetPassword);
    }

    // === RENDER SIGN UP ===
    function renderSignup() {
      mainContainer.innerHTML = `
        <header>
          <h1 data-text="DAFTAR ‚Äî PIXEL PANEL">DAFTAR ‚Äî PIXEL PANEL</h1>
          <p>Buat akun baru untuk mengakses panel.</p>
        </header>
        <div style="max-width: 320px; margin: 20px auto; padding: 16px;">
          <input type="email" id="signupEmail" placeholder="Email" style="width:100%; padding:8px; margin:6px 0; border-radius:4px; border:1px solid #3ce0c3; background:#0f1625; color:white; font-family:'Press Start 2P', monospace; font-size:10px;">
          <input type="password" id="signupPassword" placeholder="Password (min. 6 karakter)" style="width:100%; padding:8px; margin:6px 0; border-radius:4px; border:1px solid #3ce0c3; background:#0f1625; color:white; font-family:'Press Start 2P', monospace; font-size:10px;">
          <button id="createAccountBtn" style="width:100%; padding:8px; margin-top:10px; background:#3ce0c3; color:black; border:none; border-radius:4px; font-family:'Press Start 2P', monospace; font-size:10px; cursor:pointer;">
            BUAT AKUN
          </button>
          <button id="backToLoginBtn" style="width:100%; padding:6px; margin-top:6px; background:transparent; color:#7c5cff; border:1px solid #7c5cff; border-radius:4px; font-family:'Press Start 2P', monospace; font-size:9px; cursor:pointer;">
            ‚Üê Kembali ke Login
          </button>
          <p id="signupError" style="color:#ff5555; margin-top:10px; font-size:9px; text-align:center;"></p>
        </div>
        <footer>
          2025 Pixel Art Project<br>KentangDev.
        </footer>
      `;

      document.getElementById('createAccountBtn').addEventListener('click', handleSignup);
      document.getElementById('backToLoginBtn').addEventListener('click', renderLogin);
    }

    function handleLogin() {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const errorEl = document.getElementById('loginError');

      if (!email || !password) {
        errorEl.textContent = "Email dan password wajib diisi!";
        return;
      }

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          renderMenu();
        })
        .catch(err => {
          let msg = "Email atau password salah.";
          if (err.code === "auth/too-many-requests") msg = "Terlalu banyak percobaan. Coba lagi nanti.";
          errorEl.textContent = "‚ùå " + msg;
        });
    }

    function handleSignup() {
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const errorEl = document.getElementById('signupError');

      if (!email || !password) {
        errorEl.textContent = "Email dan password wajib diisi!";
        return;
      }

      if (password.length < 6) {
        errorEl.textContent = "Password minimal 6 karakter!";
        return;
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(() => {
          renderMenu();
        })
        .catch(err => {
          let msg = "Gagal membuat akun.";
          if (err.code === "auth/email-already-in-use") {
            msg = "Email sudah terdaftar.";
          } else if (err.code === "auth/invalid-email") {
            msg = "Format email tidak valid.";
          } else if (err.code === "auth/weak-password") {
            msg = "Password terlalu lemah (min. 6 karakter).";
          }
          errorEl.textContent = "‚ùå " + msg;
        });
    }

    function handleResetPassword() {
      const email = document.getElementById('email').value.trim();
      const errorEl = document.getElementById('loginError');

      if (!email) {
        errorEl.textContent = "Masukkan email terlebih dahulu!";
        return;
      }

      auth.sendPasswordResetEmail(email)
        .then(() => {
          errorEl.style.color = "#3ce0c3";
          errorEl.innerHTML = "‚úÖ Link reset password telah dikirim!";
        })
        .catch(err => {
          let msg = "Gagal mengirim email reset.";
          if (err.code === "auth/user-not-found") msg = "Email tidak terdaftar.";
          errorEl.textContent = "‚ùå " + msg;
        });
    }

    // === RENDER MENU DENGAN TOMBOL ACCOUNT DI BAWAH MENU ===
    async function renderMenu() {
      const user = auth.currentUser;
      if (!user) {
        renderLogin();
        return;
      }

      const uid = user.uid;
      const profileRef = db.collection('users').doc(uid).collection('profile').doc('info');
      let displayUid = "LOADING...";

      try {
        const doc = await profileRef.get();
        if (doc.exists && doc.data().displayUid) {
          displayUid = doc.data().displayUid;
        } else {
          displayUid = generate8DigitUid();
          await profileRef.set({ displayUid }, { merge: true });
        }
      } catch (err) {
        console.error("Gagal muat UID:", err);
        displayUid = "ERROR";
      }

      mainContainer.innerHTML = `
        <header>
          <h1 data-text="PILIHAN ‚Äî PIXEL PANEL">PILIHAN ‚Äî PIXEL PANEL</h1>
          <p>Pilih box untuk membuka file terkait.</p>
        </header>

        <div class="grid" id="menuGrid">
          <div class="box" tabindex="0" data-target="QR.html">
            <div class="icon">üó∫Ô∏è</div>
            <div class="title">QR Generator</div>
          </div>
          <div class="box" tabindex="0" data-target="fake-tweet.html">
            <div class="icon">üê¶</div>
            <div class="title">Fake Tweet</div>
          </div>
          <div class="box" tabindex="0" data-target="fake-iphone.html">
            <div class="icon">üí¨</div>
            <div class="title">eChat</div>
            <div class="subtitle">Fake iPhone</div>
          </div>
          <div class="box" tabindex="0" data-target="spam-NGL.html">
            <div class="icon">‚úâÔ∏è</div>
            <div class="title">Spam NGL</div>
            <div class="subtitle">Anonymous Q&A</div>
          </div>
        </div>

        <!-- TOMBOL ACCOUNT DI BAWAH MENU -->
        <button id="accountBtn" style="background:#7c5cff; color:white; border:none; padding:6px 12px; border-radius:4px; font-family:'Press Start 2P', monospace; font-size:9px; cursor:pointer; margin-top:16px; width:100%; max-width:150px; text-align:center;">
          üë§ Account
        </button>

        <!-- MODAL ACCOUNT -->
        <div id="accountModal" class="account-modal">
          <div style="font-size:8px; color:#b6c0d6; margin-bottom:4px;">ID:</div>
          <div id="userUid">${displayUid}</div>
          <button id="logoutBtn">üö™ LOGOUT</button>
        </div>

        <footer>
          2025 Pixel Art Project<br>KentangDev.
        </footer>
      `;

      // Toggle account modal
      document.getElementById('accountBtn').addEventListener('click', () => {
        const modal = document.getElementById('accountModal');
        if (modal.style.display === 'none') {
          modal.style.display = 'block';
        } else {
          modal.style.display = 'none';
        }
      });

      // Salin UID saat klik
      document.getElementById('userUid').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(displayUid);
          alert("‚úÖ ID disalin!");
        } catch (err) {
          alert("‚ùå Gagal menyalin");
        }
      });

      // Logout
      document.getElementById('logoutBtn').addEventListener('click', () => {
        auth.signOut().then(() => {
          renderLogin();
        }).catch(err => {
          console.error("Logout gagal:", err);
        });
      });

      // Navigasi
      document.querySelectorAll('.box').forEach(box => {
        box.addEventListener('click', () => {
          const t = box.dataset.target;
          if (t) window.location.href = t;
        });
        box.addEventListener('keydown', e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            const t = box.dataset.target;
            if (t) window.location.href = t;
          }
        });
      });

      setupInspectProtection();
    }

    // === PROTEKSI INSPECT DENGAN FIRESTORE ===
    async function setupInspectProtection() {
      const MAX_ATTEMPTS = 3;
      const BLOCK_DURATION = 120000;
      const user = auth.currentUser;
      if (!user) return;

      const uid = user.uid;
      const attemptsRef = db.collection('users').doc(uid).collection('security').doc('attempts');

      const doc = await attemptsRef.get();
      const now = Date.now();

      if (doc.exists) {
        const data = doc.data();
        if (data.blockedUntil && now < data.blockedUntil) {
          window.location.href = "banned.html";
          return;
        }
        if (data.lastAttempt && now - data.lastAttempt > BLOCK_DURATION) {
          await attemptsRef.update({
            attempts: 0,
            lastAttempt: firebase.firestore.FieldValue.delete(),
            blockedUntil: firebase.firestore.FieldValue.delete()
          });
        }
      }

      async function addAttempt() {
        const now = Date.now();
        const doc = await attemptsRef.get();
        let attempts = 0;

        if (doc.exists) {
          const d = doc.data();
          if (d.blockedUntil && now < d.blockedUntil) {
            window.location.href = "banned.html";
            return;
          }
          attempts = d.attempts || 0;
        }

        const newAttempts = attempts + 1;
        if (newAttempts >= MAX_ATTEMPTS) {
          await attemptsRef.set({
            attempts: newAttempts,
            blockedUntil: now + BLOCK_DURATION,
            lastAttempt: now
          }, { merge: true });
          window.location.href = "banned.html";
        } else {
          await attemptsRef.set({
            attempts: newAttempts,
            lastAttempt: now
          }, { merge: true });
          document.getElementById("warningMessage1").innerText = `Peringatan (${newAttempts}/${MAX_ATTEMPTS})`;
          document.getElementById("warningPopup1").style.display = "flex";
        }
      }

      document.addEventListener('contextmenu', async (e) => {
        e.preventDefault();
        await addAttempt();
      });

      document.addEventListener('keydown', async (e) => {
        if (e.key === 'F12' || 
            (e.ctrlKey && e.shiftKey && ['I','J'].includes(e.key.toUpperCase())) || 
            (e.ctrlKey && e.key.toUpperCase() === 'U')) {
          e.preventDefault();
          await addAttempt();
        }
      });
    }

    // === CEK LOGIN SAAT DIMUAT ===
    auth.onAuthStateChanged(user => {
      if (user) {
        renderMenu();
      } else {
        renderLogin();
      }
    });
  </script>
</body>
</html>